<html>
<head>
    <meta charset=utf-8>
    <title>My first Three.js app</title>
    <style>
        body {
            margin: 0;
        }

        canvas {
            width: 100%;
            height: 100%
        }
    </style>
</head>

<body>

<script src="./node_modules/jquery/dist/jquery.min.js"></script>
<script src="./node_modules/three/three.min.js"></script>

<script>
    var cameraMoves = {speed: 5};
    var cameraLookAt = {x: 10, y: 0, z: 10};
    var mouse = {x: 0, y: 0};

    function mouseMove(e) {
        var xCursor = (window.innerWidth / 2 - e.clientX) * 0.05;
        var yCursor = (window.innerHeight / 2 - e.clientY) * 0.05;

        console.log(xCursor)
        cameraLookAt.x += Math.max(Math.min(xCursor, cameraMoves.speed), -cameraMoves.speed);
        cameraLookAt.y += Math.max(Math.min(yCursor, cameraMoves.speed), -cameraMoves.speed);
        mouse.x = e.clientX;
        mouse.y = e.clientY;

    }
    window.addEventListener('mousemove', mouseMove);


    var BORDER = 20;
    var SPEED_MOVEMENT = 0.1;

    var keys = {
        ArrowUp: false,
        ArrowDown: false,
        ArrowLeft: false,
        ArrowRight: false
    };


    $("body").keydown(function (e) {
        if (["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"].indexOf(e.originalEvent.key) >= 0) {
            keys[e.originalEvent.key] = true;
        }
    });

    $("body").keyup(function (e) {
        if (["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"].indexOf(e.originalEvent.key) >= 0) {
            keys[e.originalEvent.key] = false;
        }
    });

    var scene = new THREE.Scene();
    var camera = new THREE.PerspectiveCamera(90, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.y = 2;
    camera.position.x = 10;
    camera.position.z = 2;
    var renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);
    var cube = new THREE.BoxGeometry(1, 1, 1);


    //draw ground
    var grassTexture = THREE.ImageUtils.loadTexture('./images/grass.png');
    var grassMesh = new THREE.MeshBasicMaterial({map: grassTexture});
    for (var x = 0; x < BORDER; x++) {
        for (var z = 0; z < BORDER; z++) {
            var grassCube = new THREE.Mesh(cube, grassMesh);
            grassCube.position.x = x;
            grassCube.position.z = z;
            scene.add(grassCube);
        }
    }

    var wallTexture = THREE.ImageUtils.loadTexture('./images/wall.jpg');
    var wallMesh = new THREE.MeshBasicMaterial({map: wallTexture});
    for (var y = 1; y < 3; y++) {
        for (var x = 0; x < BORDER; x++) {
            for (var z = 0; z < BORDER; z++) {
                if (x === 0 || z === 0 || x === BORDER - 1 || z === BORDER - 1) {
                    var wallCube = new THREE.Mesh(cube, wallMesh);
                    wallCube.position.x = x;
                    wallCube.position.z = z;
                    wallCube.position.y = y;
                    scene.add(wallCube);
                }
            }
        }
    }

    function render() {
        camera.lookAt(new THREE.Vector3(cameraLookAt.x, cameraLookAt.y, camera.position.z + 10));
        camera.position.x += keys.ArrowRight ? -SPEED_MOVEMENT : keys.ArrowLeft ? SPEED_MOVEMENT : 0;
        camera.position.z += keys.ArrowDown ? -SPEED_MOVEMENT : keys.ArrowUp ? SPEED_MOVEMENT : 0;

        requestAnimationFrame(render);
        renderer.render(scene, camera);
    }
    render();


</script>

</body>
</html>
