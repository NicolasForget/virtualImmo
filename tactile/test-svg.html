<!DOCTYPE HTML>
<html>
	<head>
    	<meta charset="UTF-8">
	    <link rel="stylesheet" type="text/css" href="style-svg.css" />
	    <!-- Latest compiled and minified CSS -->
	    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    
	    <!-- jQuery library -->
	    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

	    <!-- Latest compiled JavaScript -->
	    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	    <!-- library of d3 -->
	    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	    <!-- pie menu -->
	    <script type="text/javascript" src="js/menu.js"></script>
	    <!-- button -->
	    <script type="text/javascript" src="js/button.js"></script>
	    <!-- checkbox -->
	    <script type="text/javascript" src="js/checkbox.js"></script>

	    <script type="text/javascript" src="js/removebox.js"></script>




	    
	</head>
	<body>

	    <!-- main div -->
	    <div class="container-fluid">
	    	<div class="row">
		    	<div id="rotateController" class="center-block" style="visibility: hidden">
					<input id="rAngle" type="range" min="0" max="360">
					<span id="rAngle-value">0</span>
		    	</div>
			</div>
	    	<!-- <div id="selectBox"></div> -->
	    	<!-- <div id="selectBoxRot"></div> -->
	    	<!-- <div class="row">
		    	<div id="sofaRotate" class="center-block" style="visibility: hidden">
					<input id="nAngle" type="range" min="0" max="360">
					<span id="nAngle-value">0</span>
					<div id="checkSofaPlaced"></div>
		    	</div>
			</div> -->

			

	      	<div class="row">
	        	<div class="center-block" id="main-content">
	             	<svg id="roomMap" width="1500" height="800"></svg>
	        	</div>
	      	</div>
	      	<div id="toolBar"></div>
	      	<div id="rotaryKnob" style="visibility: visible">
		      		<svg viewBox="-6 -6 12 12" class="dial" id="foobar">
					  <defs>
					    <radialGradient id="knobgradient">
					      <stop offset="0" stop-color="gray"/>
					      <stop offset="4" stop-color="silver"/>
					    </radialGradient>
					  </defs>
					  <g class="knob">
					    <circle class="knob_center" cx="0" cy="0" r="0.055625"/>
					    <g class="knob_gfx">
					      <circle cx="0" cy="0" r="5"/>
					      <line x1="0" y1="-1.5" x2="0" y2="-4.5"/>
					    </g>
					    <text class="knob_number"/>
					  </g>
					</svg>
					<!-- <p><label><input type="checkbox" id="snapping"> Snap to</label> <input type="number" id="snapping_granularity" min="2" value="16" size="2" style="width: 4em"> divisions</p> -->
		      	</div>
	    <!-- pie menu div -->
	    <div id="piemenu" class="piemenuLastLayer">
	      	<svg width="400" height="400">
	        	<g id="menu-holder" transform="translate(200,200)"></g>
	      	</svg>
	    </div>

	    <div id="tvMenu" class="piemenuLastLayer">
	      	<svg width="400" height="400">
	        	<g id="menu-tv" transform="translate(200,200)"></g>
	      	</svg>
	    </div>

	    <div id="tableMenu" class="piemenuLastLayer">
	      	<svg width="400" height="400">
	        	<g id="menu-table" transform="translate(200,200)"></g>
	      	</svg>
	    </div>


	    <div id="resetButton"></div>
	    <script type="text/javascript" src="js/toolbar.js"></script>


	    
	    <script type="text/javascript" src="js/rotaryKnob.js"></script>
	    
	    <script src="http://mayl.me:8080/socket.io/socket.io.js"></script>
		<script>

			

		   var sofaSelected;
		   var selectSofaIndex = 0;

		   var selectValue = "";

		   function changeSelectValue(value){
		   		selectValue = value;
		   }
		   var socket = io.connect('http://mayl.me:8080');

			//init socket for create the wall.
		    // var socket = io.connect('http://192.168.43.43:4200');
		   //  socket.on('connect', function () {
		   //          var murs = [
					//     {
					//         type: "wall",
					//         x: 0,
					//         y: 0,
					//         length: 15,
					//         radius: 0
					//     },
					//     {
					//         type: "wall",
					//         x: 15,
					//         y: 0,
					//         length: 6,
					//         radius: 270
					//     },
					//     {
					//         type: "wall",
					//         x: 15,
					//         y: 6,
					//         length: 2,
					//         radius: 270
					//     },
					//     {
					//         type: "door",
					//         x: 15,
					//         y: 8,
					//         length: 2,
					//         radius: 270
					//     },
					//     {
					//         type: "wall",
					//         x: 15,
					//         y: 10,
					//         length: 5,
					//         radius: 270
					//     },
					//     {
					//         type: "wall",
					//         x: 7.5,
					//         y: 6,
					//         length: 15,
					//         radius: 0
					//     },
					//     {
					//         type: "wall",
					//         x: 30,
					//         y: 6,
					//         length: 9,
					//         radius: 270
					//     },
					//     {
					//         type: "wall",
					//         x: 11,
					//         y: 15,
					//         length: 11,
					//         radius: 180
					//     },
					//     {
					//         type: "door",
					//         x: 5.5,
					//         y: 15,
					//         length: 2,
					//         radius: 0
					//     },
					//     {
					//         type: "wall",
					//         x: 6.5,
					//         y: 15,
					//         length: 2,
					//         radius: 0
					//     },
					//     {
					//         type: "wall",
					//         x: 7.5,
					//         y: 15,
					//         length: 15,
					//         radius: 0
					//     },
					//     {
					//         type: "wall",
					//         x: 0,
					//         y: 0,
					//         length: 15,
					//         radius: 270
					//     },
					//     {
					//         type: "roof",
					//         x: 0,
					//         y: 0,
					//         xLength: 15,
					//         yLength: 15
					//     },
					//     {
					//         type: "roof",
					//         x: 15,
					//         y: 6,
					//         xLength: 15,
					//         yLength: 9
					//     }
					// ];
		   //          socket.emit('wallTable', murs);
		   //  });

		   //sofa data from server
		   
		   socket.emit("tableWantFurniture","sofa");

		   socket.on('availableSofas', function (data) {
		   		console.log(data);
		   		if(data.length > 2){
		   		for (var i = 0; i < data.length;i++){
		   			var sofaMenuInfo = data[i];
		   			// var sofas=[];

		   			var s = [];

			   		var size = sofaMenuInfo.size
			   		var colors = Object.keys(sofaMenuInfo.textures);
			   		for (var k = 0; k < colors.length;k++){
			   			// console.log(k);
			   			var color = colors[k];
			   			var texture = sofaMenuInfo.textures[color];
			   			console.log(texture);
				   		var sofaColors = {
				   			id : sofaMenuInfo.id,
				   			textureId:texture.id,
							icon:texture.topImg,
							action:"objectSelect(sofas["+sofaMenuInfo.id+"]," + k + ",\"sofa\");",
							size:{
								length: (size.z * 100),
								width: (size.x * 100)
							},
							color: color
						};
						// sofas.push(sofaColors);
						s.push(sofaColors);

					}
					sofas[i] = s;

					// sofass.push(sofas);

					var sofa = {
						id:i,
						icon:sofaMenuInfo.miniature,
						action:"createMenuMeuble(menuPositionX,menuPositionY,sofas,\"sofa\","+i+");",
						object: data[i]
					}
					meubleSofaMenu.push(sofa);
				}
			}
			// console.log(meubleSofaMenu);
				// console.log(sofass);
				//-------------------------------------select Meuble-----------------------------------------------

				// var select = d3.select('#selectBox')
				//   .append('select')
				//   	.attr('class','select')
				//     .on('change',onchange);

				// var options = select
				//   .selectAll('option')
				// 	.data(["sofa", "table", "tv"]).enter()
				// 	.append('option')
				// 		.text(function (d) { return d; });

				// function onchange() {
				// 	selectValue = d3.select('#selectBox').select('select').property('value')
				// 	// console.log(selectValue);
				// };
				// -----------------------------------select Meuble -------------------------------------------------

		   });

		   socket.emit("tableWantFurniture","table");

		   socket.on('availableTables', function (data) {
		   		console.log(data);
		   		for (var i = 0; i < data.length;i++){
		   			var tvMenuInfo = data[i];
		   			// var sofas=[];
		   			var t = [];
			   		var size = tvMenuInfo.size
			   		var colors = Object.keys(tvMenuInfo.textures);
			   		
			   		for (var k = 0; k < colors.length;k++){
			   			// console.log(k);
			   			var color = colors[k];
			   			var texture = tvMenuInfo.textures[color];
			   			console.log(texture);
				   		var tvColors = {
				   			id : tvMenuInfo.id,
				   			textureId:texture.id,
							icon:texture.topImg,
							action:"objectSelect(tvs[" + i + "]," + k + ",\"table\");",
							size:{
								length: (size.z * 100),
								width: (size.x * 100)
							},
							color: color
						};
						t.push(tvColors);
					}

					tvs[i] = t;

					// sofass.push(sofas);

					var tv = {
						id:i,
						icon:tvMenuInfo.miniature,
						action:"createMenuMeuble(menuPositionX,menuPositionY,tvs,\"table\","+i+");",
						object: data[i]
					}
					meubleTvMenu.push(tv);
				}
				// console.log(sofass);
				//-------------------------------------select Meuble-----------------------------------------------

				// var select = d3.select('#selectBox')
				//   .append('select')
				//   	.attr('class','select')
				//     .on('change',onchange);

				// var options = select
				//   .selectAll('option')
				// 	.data(["sofa", "tv"]).enter()
				// 	.append('option')
				// 		.text(function (d) { return d; });

				// function onchange() {
				// 	selectValue = d3.select('#selectBox').select('select').property('value')
				// 	// console.log(selectValue);
				// };
				createToolBar();
				// -----------------------------------select Meuble -------------------------------------------------

		   });
		   


		   	socket.on("changedFurnitureTexture",function(data){
		   		var c = "";
		   		console.log("[changedFurnitureTexture]" + data);
	            switch(data.texture_id){
	            	case "beige":c = "#f5f5dc";break;
	            	case "noir":c = "black";break;
	            	case "bordeau": c = "red";break;
	            	case "blanc":c = "white";break;
	            	default : c = "#A9A9A9";
	            }
		   		
				// console.log(data);
				container.select(".g-"+data.type+"s").selectAll(".g-element").each(function(){
					if(data.index == d3.select(this).select("rect").attr("meubleIndex")){
						d3.select(this).select("rect").style("fill",c);
					}
				});
			});

			socket.on("removeFurniture",function(data){
		   		console.log("[removeFurniture] "+data);
		   		container.select(".g-"+data.type+"s").selectAll(".g-element").each(function(){
					if(data.index == d3.select(this).select("rect").attr("meubleIndex")){
						d3.select(this).remove();
					}
				});
			});



		</script>



        <script>

        	//-----------------select rotate element -------------------

        	var rotElement = "map";
   //      	var selectRot = d3.select('#selectBoxRot')
			// 	  .append('select')
			// 	  	.attr('class','select')
			// 	    .on('change',onchangeRot);

			// var optionsRot = selectRot
			// 	  .selectAll('option')
			// 		.data(["map", "sofamenu","tvmenu","meuble"]).enter()
			// 		.append('option')
			// 			.text(function (d) { return d; });

			// function onchangeRot() {
			// 	rotElement = d3.select('#selectBoxRot').select('select').property('value')
			// 		// console.log(selectValue);
			// };

			
			//---------------- select rotate elment -----------------------


        	// the sofa data array 
        	var meubleSofaMenu = [];
        	var meubleTvMenu = [];

        	// var sofass=[];

        	// the sofa data array 
        	var sofas = [
	            // { icon : "img/1.png", action: "sofaSelect(0);", size : {length: 100, width : 180} , color : "black"},
	            // { icon : "img/2.png", action: "sofaSelect(1);", size : {length: 100, width : 200} , color : "blue" },
	            // { icon : "img/4.png", action: "sofaSelect(2);", size : {length: 80, width : 150} , color : "green" },
	            // { icon : "img/9.png", action: "sofaSelect(3);", size : {length: 90, width : 250} , color : "red" },
	            // { icon : "img/8.png", action: "sofaSelect(4);", size : {length: 110, width : 220} , color : "yellow" }
        	];

        	// the beds data array 
        	var tvs = [
	            // { id:1,textureId:"blue", icon : "img/bed-1.png", action: "objectSelect(tvs,0,\"tv\");", size : {length: 240, width : 220} ,color : "blue" },
	            // { id:2,textureId:"green",icon : "img/bed-2.png", action: "objectSelect(tvs,1,\"tv\");", size : {length: 200, width : 180} ,color : "green" }
        	];

        	// the tables data array 
        	var tables = [
	            { id:1,textureId:"blue",icon : "img/table-1.png", action: "objectSelect(tables,0,\"table\");", size : {length: 100, width : 60}, color : "blue" },
	            { id:2,textureId:"green",icon : "img/table-2.png", action: "objectSelect(tables,1,\"table\");", size : {length: 80, width : 40}, color : "green" },
	            { id:3,textureId:"red",icon : "img/table-3.png", action: "objectSelect(tables,2,\"table\");", size : {length: 120, width : 80}, color : "red" }
        	];





        	// the four points of a sofa
        	// var sofaPoints = [
        	// 	{x : 0, y : 0},
        	// 	{x : 0, y : 0},
        	// 	{x : 0, y : 0},
        	// 	{x : 0, y : 0}
        	// ];

        	// var sofaColor;

        	var m;
        	//mouse click position
        	var clickX,clickY;
        	//sofa position relative to the room
        	var rectX = 0;
        	var rectY = 0;

        	var createPosition = {
        		sofa : {
        			x:0,
        			y:0
        		},
        		table : {
        			x:0,
        			y:0
        		},
        		tv : {
        			x:0,
        			y:0
        		}
        	};

        	var menuPositionX = 0;
        	var menuPositionY = 0;

        	var checkBox = new CheckBox();

        	var sofaPlacedCheck;

        	var sofaSelectedCenterX = 0;
        	var sofaSelectedCenterY = 0;

        	var sofaDemiDiagonal;

        	var currentAngle = 0;
        	var buttonSvg;

        	var imgHeight = 800, imgWidth = 1500,      // Image dimensions (don't change these)
            	width =  1500, height = 800,             // Dimensions of cropped region
            	translate0 = [0, 0], scale0 = 1;  // Initial offset & scale

           	// var imgHeight = 800, imgWidth = 800,      // Image dimensions (don't change these)
            // 	width =  800, height = 800,             // Dimensions of cropped region
            // 	translate0 = [0, 0], scale0 = 1;  // Initial offset & scale

        	var zoom = d3.behavior.zoom()
		    	.scaleExtent([1, 8])
		    	.on("zoom", zoomed);

        	svg = d3.select("#roomMap")
            	.attr("width",  width + "px")
            	.attr("height", height + "px")
            	.append("g")
            	.attr("transform", "translate(" + translate0 + ")").attr("id","g-map")
            	.call(zoom)
            	.on("dblclick.zoom", null);

          	var rect = svg.append("rect")
              	.attr("fill","#ffffff")
              	.attr("class", "overlay")
              	.attr("width", width + "px")
              	.attr("height", height + "px");

          	var container = svg.append("g").attr("class","zoomArea").attr("transform","translate(0,0)scale(1)");
          	container.append("g").attr("class","imgMap").attr("transform","translate(0,0)").append("image")
              	.attr("width",  imgWidth + "px")
              	.attr("height", imgHeight + "px")
             	.attr("xlink:href", "img/big-room.png");
              	// .attr("xlink:href", "img/room-small.png");

          	container.append("g")
		    	.attr("class", "x axis")
		  		.selectAll("line")
		    	.data(d3.range(60, width - 60, 10))
		  		.enter().append("line")
			    .attr("x1", function(d) { return d; })
			    .attr("y1", 60)
			    .attr("x2", function(d) { return d; })
			    .attr("y2", height - 60);

			container.append("g")
			    .attr("class", "y axis")
			  	.selectAll("line")
			    .data(d3.range(60, height - 60, 10))
			  	.enter().append("line")
			    .attr("x1", 60)
			    .attr("y1", function(d) { return d; })
			    .attr("x2", width - 60)
			    .attr("y2", function(d) { return d; });

			container.append("g")
				.attr("class","legend")
				.append("g")
				.attr("class","legend-line")
				.selectAll("line")
			    .data(d3.range(10, 30, 10))
			  	.enter().append("line")
			    .attr("x1", 10)
			    .attr("y1", function(d) { return d; })
			    .attr("x2", 20)
			    .attr("y2", function(d) { return d; });

			container.select(".legend")
				.append("g")
				.attr("class","legend-line")
				.selectAll("line")
			    .data(d3.range(10, 30, 10))
			  	.enter().append("line")
			    .attr("x1", function(d) { return d; })
			    .attr("y1", 10)
			    .attr("x2", function(d) { return d; })
			    .attr("y2", 20);
			container.select(".legend").append("text").attr("x","30").attr("y","20").text("Each square is 10px Ã— 10px");

			container.append("g").attr("class","g-sofa").attr("transform","translate(0,0)").append("text");

			var meuble = container.append("g").attr("class","g-meuble").attr("transform","translate(0,0)");
			var domTvs = meuble.append("g").attr("class","g-tvs").attr("transform","translate(0,0)");
			var domTables = meuble.append("g").attr("class","g-tables").attr("transform","translate(0,0)");
			var domSofas = meuble.append("g").attr("class","g-sofas").attr("transform","translate(0,0)");

          	svg.on("click",doubleClick);

       //    	var drag = d3.behavior.drag()
			    // .on("dragstart", dragstarted)
			    // .on("drag", dragged)
			    // .on("dragend", dragended);
			updateR(0);



			function createMeubleSelectMenu(x,y,type){
				switch(type){
					case "table":
						changeMenuLayer(true,"tvMenu");
			            if(mtv){
			              mtv.hide();
			            }
			            
			            d3.select("#menu-tv").selectAll("g").each(function(){
			              d3.select(this).remove();
			            });
			            
			            mtv = new d3.radialMenu().radius(50).thickness(150).iconSize(120).arrow("img/arrow.png")
			                        .appendTo("#menu-tv").show(meubleTvMenu);

			            var menu = $("#tvMenu");
			            menu.css('position', 'absolute');
			            menu.css("left", x - 200);
			            menu.css("top", y - 200);
						break;
					default:
						changeMenuLayer(true,"piemenu");
			            if(m){
			              m.hide();
			            }
			            
			            d3.select("#menu-holder").selectAll("g").each(function(){
			              d3.select(this).remove();
			            });
			            
			            m = new d3.radialMenu().radius(50).thickness(150).iconSize(120).arrow("img/arrow.png")
			                        .appendTo("#menu-holder").show(meubleSofaMenu);

			            var menu = $("#piemenu");
			            menu.css('position', 'absolute');
			            menu.css("left", x - 200);
			            menu.css("top", y - 200);
				}
				
			}

			function doubleClick(){
				if(selectValue == "sofa" || selectValue == "table"){
					var zoomAreaPosition = d3.select(".zoomArea").attr("transform").split(/\(|\,|\)/);
		            
		            clickX = d3.mouse(this)[0] - parseFloat(zoomAreaPosition[1],10);
		            clickY = d3.mouse(this)[1] - parseFloat(zoomAreaPosition[2],10);

		            rectX = clickX;
		            rectY = clickY;

		            menuPositionX = d3.event.pageX;
		            menuPositionY = d3.event.pageY;
		            // console.log(clickX);
		            // console.log(clickY);
		            // createMeubleSelectMenu(d3.event.pageX, d3.event.pageY);
		            switch(selectValue){
		            	// case "table":createMenu(menuPositionX,menuPositionY,tables);break;
		            	// case "bed":createMenu(menuPositionX,menuPositionY,beds);break;
		            	// case "table":
		            	// 	createMenuMeuble(menuPositionX,menuPositionY,tables,"table",null);
		            		// break;
		            	case "table":
		            		createMeubleSelectMenu(d3.event.pageX, d3.event.pageY,"table");
		            		break;
		            	default: 
		            		createMeubleSelectMenu(d3.event.pageX, d3.event.pageY,"sofa");
		            };

		            createPosition[selectValue].x = rectX;
		            createPosition[selectValue].y = rectY;
		            console.log(createPosition);
		        }
			}	


          	function zoomed() {
          		showResetButton();
          		var rotateValue = container.attr("transform").split("rotate")[1];
            	container.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")rotate"+rotateValue);
          	}

   //        	function dragstarted(d) {
   //        		var postion = d3.select(this).attr("transform").split(/\(|\)|\,/);
	  //         	rectX = parseFloat(postion[1],10);
			// 	rectY = parseFloat(postion[2],10);

			//   	d3.event.sourceEvent.stopPropagation();
			//   	d3.select(this).classed("dragging", true);
			//   	d3.select(this.parentNode).select("text").text("Moving").attr("transform", "translate(" + (rectX + sofaSelectedCenterX - 55) + "," + (rectY + sofaSelectedCenterY + 8) + ")");
			//   	sofaPlacedCheck.style("visibility","hidden");
			// }

			// function dragged(d) {
			// 	rectX += d3.event.dx;
			// 	rectY += d3.event.dy;
			// 	var sofaWidth = parseFloat(d3.select(this).attr("width"),10);
			// 	var sofaHeight = parseFloat(d3.select(this).attr("height"),10);

			// 	setSofaPoints();
			//     // console.log(sofaPoints);
			//     // console.log(isSofaBadPlaced());
			// 	if(isSofaBadPlaced()){
			// 		d3.select(this).classed("badPlace",true);
			// 		d3.select(this.parentNode).select("text").text("BadPlaced").attr("transform", "translate(" + (rectX + sofaSelectedCenterX - 85) + "," + (rectY + sofaSelectedCenterY + 8) + ")");
			// 	}else{
			// 		d3.select(this).classed("badPlace",false);
			// 		d3.select(this.parentNode).select("text").text("Moving").attr("transform", "translate(" + (rectX + sofaSelectedCenterX - 55) + "," + (rectY + sofaSelectedCenterY + 8) + ")");;
			// 	}
			// 	d3.select(this).attr('transform', "translate(" + rectX + "," + rectY + ")rotate(" + currentAngle + "," + sofaSelectedCenterX + "," + sofaSelectedCenterY + ")");;
				
			//     sofaPlacedCheck.attr("transform","translate(" + (sofaPoints[2].x - 10) + "," + (sofaPoints[2].y - 10) + ")");
			// }

			// function dragended(d) {
				
			//   	d3.select(this).classed("dragging", false);
			//   	if(isSofaBadPlaced()){
			//   		sofaPlacedCheck.style("visibility","hidden");
			//   		d3.select(this.parentNode).select("text").text("BadPlaced").attr("transform", "translate(" + (rectX + sofaSelectedCenterX - 85) + "," + (rectY + sofaSelectedCenterY + 8) + ")");
			//   	}else{
			//   		sofaPlacedCheck.style("visibility","visible");
			//   		d3.select(this.parentNode).select("text").text("Check to place it.").attr("transform", "translate(" + (rectX + sofaSelectedCenterX - 120) + "," + (rectY + sofaSelectedCenterY + 8) + ")");;
			//   	}
			// }
          


          	// function createMenu(x,y,menuElements){
          	// 	// selectSofaIndex = index;
	          //   changeLayer(true);
	          //   if(m){
	          //     m.hide();
	          //   }
	            
	          //   d3.select("#menu-holder").selectAll("g").each(function(){
	          //     d3.select(this).remove();
	          //   });
	            
	          //   m = new d3.radialMenu().radius(50).thickness(150).iconSize(120).arrow("img/arrow.png")
	          //               .appendTo("#menu-holder").show(menuElements);

	          //   var menu = $("#piemenu");
	          //   menu.css('position', 'absolute');
	          //   menu.css("left", x - 200);
	          //   menu.css("top", y - 200);
          	// }

          

          	function changeLayer(flag){
	            if(flag){
	              d3.select("#piemenu").attr("class","piemenufirstLayer");
	            }else{
	              d3.select("#piemenu").attr("class","piemenuLastLayer");
	            }
          	}

          	// function sofaSelect(index){
	          //   // console.log(index);
	          //   if(m)m.hide();
	          //   changeLayer(false);
	          //   var sofa = sofas[index];
	          //   sofaColor = sofa.color;
	          //   sofaSelected = index;
	          //   createSofa(clickX,clickY,sofa.size.width,sofa.size.length);
	          //   console.log(sofaColor);
	          //   // console.log(sofa.size);
          	// }

    //       	function createSofa(x,y,width,height){
    //       		showResetButton();
    //       		update(0);
    //       		currentAngle = 0;
    //       		sofaDemiDiagonal = Math.sqrt(width * width + height * height) / 2;
    //       		sofaSelectedCenterX = width / 2;
	   //          sofaSelectedCenterY = height / 2;
	   //          setSofaPoints();

	   //          var c = "";
	   //          switch(sofaColor){
	   //          	case "beige":c = "#f5f5dc";break;
	   //          	case "noir":c = "black";break;
	   //          	default : c = "#A9A9A9";
	   //          }

	   //          if(container.select(".g-sofa").select('rect')[0][0] !== null){
	   //            container.select(".g-sofa").select('rect').remove();
	   //          }
	   //          container.select(".g-sofa").attr("transform","translate(0,0)").append('rect').attr("transform","translate(" + x + "," + y + ")rotate(0,0,0)").attr("fill-opacity","0.8").attr("width",width)
	   //          	.attr("height",height).attr("fill",c).call(drag);
	   //         	// container.select(".g-sofa").append("image").attr("id","sofaImage").attr("href","data:image/png;base64,"+meubleMenu[selectSofaIndex].sofaObject.textures[sofaColor].topImg).attr("height",meubleMenu[selectSofaIndex].sofaObject.size.z*100).attr("width",meubleMenu[selectSofaIndex].sofaObject.size.x*100).attr("transform","translate(" + x + "," + y + ")rotate(0,0,0)");
	   //          if(sofaPlacedCheck)	
	   //          	sofaPlacedCheck.remove();

	   //          checkBox.size(20).x(sofaPoints[2].x - 10).y(sofaPoints[2].y - 10).rx(5).ry(5).markStrokeWidth(2).boxStrokeWidth(3).checked(false).clickEvent(function(){
	   //          	if(checkBox.checked()){
	   //          		d3.select("#sofaRotate").style("visibility","hidden");
	   //          		container.select(".g-sofa").select("rect").classed("sofaPlaced",true).on('mousedown.drag', null);
	   //          		container.select(".g-sofa").select("text").text("Placed").attr("transform", "translate(" + (rectX + sofaSelectedCenterX - 55) + "," + (rectY + sofaSelectedCenterY + 8) + ")");

	   //          		//Create sofa dimension table and send it to server

	   //          		var o = meubleMenu[selectSofaIndex].sofaObject;
	   //          		console.log(o);

				// 	    var sofaObject = {
				// 	    	type : selectValue,
				// 	    	id:""+selectSofaIndex,
				// 	    	textureId:sofaColor,
				// 	    	position:{
				// 	    		x:2,
				// 	    		y:0.5,
				// 	    		z:2,
				// 	    		angle: (360 - currentAngle)
				// 	    	}
				// 	    };
				// 	    socket.emit('tableAddFurniture', sofaObject);
				// 	    console.log(sofaObject);
				// 	    console.log("sofa Send to server");


	   //          	}else{
	   //          		d3.select("#sofaRotate").style("visibility","visible");
	   //          		container.select(".g-sofa").select("rect").classed("sofaPlaced",false).call(drag);
	   //          		container.select(".g-sofa").select("text").text("Check to place it").attr("transform", "translate(" + (rectX + sofaSelectedCenterX - 120) + "," + (rectY + sofaSelectedCenterY + 8) + ")");
	   //          	}
	   //          });

	            
	   //          d3.select("#sofaRotate").style("visibility","visible");
	   //          container.select(".g-sofa").call(checkBox);
	   //          sofaPlacedCheck = d3.select(".g-sofa").select(".placeObject");
	   //          if(isSofaBadPlaced()){
				// 	container.select(".g-sofa").select('rect').classed("badPlace",true);
				// 	container.select(".g-sofa").select("text").text("BadPlaced").attr("transform", "translate(" + (rectX + sofaSelectedCenterX - 85) + "," + (rectY + sofaSelectedCenterY + 8) + ")");
				// 	if(sofaPlacedCheck)
				// 		sofaPlacedCheck.style("visibility","hidden");
				// }else{
				// 	container.select(".g-sofa").select("text").text("Check to place it").attr("transform", "translate(" + (rectX + sofaSelectedCenterX - 120) + "," + (rectY + sofaSelectedCenterY + 8) + ")");
				// 	container.select(".g-sofa").select('rect').classed("badPlace",false);
				// 	if(sofaPlacedCheck)
				// 		sofaPlacedCheck.style("visibility","visible");
				// }
	            
    //       	}

			function showResetButton(){
				if(buttonSvg == null){
					buttonSvg = d3.select('#resetButton').append('svg')
					    .attr('width', 200)
					    .attr('height', 100)

					var gButton = buttonSvg.append('g')
					    .attr('class', 'button')
					    .attr('transform', 'translate(100,50)')

					var text = gButton.append('text')
					    .text('Map Reset');

					button()
					  .container(gButton)
					  .text(text)
					  .count(0)
					  .cb(function() { hideResetButton(); })();
				}
			}

			function hideResetButton(){
				buttonSvg = null;
				zoom.scale(1);
				zoom.translate([0,0]);
				d3.select('#resetButton').select("svg").remove();
				d3.select(".zoomArea").attr("transform","translate(0,0)scale(1)rotate(0,750,400)");
				// d3.select(".zoomArea").attr("transform","translate(0,0)scale(1)rotate(0,400,400)");
				// if(container.select(".g-sofa").select('rect')[0][0] !== null){
	   //            container.select(".g-sofa").select('rect').remove();
	   //          }

	            // container.select(".g-tables").selectAll('.g-element').each(function(){
	            // 	d3.select(this).remove();
	            // });

	            // container.select(".g-tvs").selectAll('.g-element').each(function(){
	            // 	d3.select(this).remove();
	            // });

	            // container.select(".g-sofas").selectAll('.g-element').each(function(){
	            // 	d3.select(this).remove();
	            // });

	            updateR(0);


	            // d3.select("#sofaRotate").style("visibility","hidden");
	            // container.select(".g-sofa").select("text").text("");
	            // if(sofaPlacedCheck)
	            // 	sofaPlacedCheck.remove();
			}

			// when the input range changes update the angle 
			// d3.select("#nAngle").on("input", function() {
			//   	update(+this.value);
			// });

			// when the input range changes update the angle 
			d3.select("#rAngle").on("input", function() {
			  	updateR(+this.value);
			});

			// update the element
			function updateR(nAngle) {
			  	d3.select("#rAngle-value").text(nAngle);
			  	d3.select("#rAngle").property("value", nAngle);

			  	// if(rotElement == 'map'){
			  	// 	rotateMap(nAngle);
			  	// }else if(rotElement == 'sofamenu'){
			  	// 	rotateMenu(nAngle,"menu-holder");
			  	// }else if(rotElement == 'tablemenu'){
			  	// 	rotateMenu(nAngle,"menu-table");
			  	// }else if(rotElement == 'tvmenu'){
			  	// 	rotateMenu(nAngle,"menu-tv");
			  	// }else if(rotElement == 'meuble'){
			  	// 	rotateMeubleSelected(nAngle);
			  	// }
			  	// if(selectValue == 'map'){
			  	// 	rotateMap(nAngle);
			  	// }
			  	// else
			  	 if(selectValue == 'sofa'){
			  		rotateMenu(nAngle,"menu-holder");
			  	}
			  	// else if(selectValue == 'tablemenu'){
			  	// 	rotateMenu(nAngle,"menu-table");
			  	// }
			  	else if(selectValue == 'table'){
			  		rotateMenu(nAngle,"menu-tv");
			  	}else{
			  		rotateMap(nAngle);
			  	}
			  	// else if(selectValue == 'touchRotate'){
			  	// 	rotateMeubleSelected(nAngle);
			  	// }

			}

			//------------------------------------------   rotate function --------------------------------------------------
			function rotateMap(nAngle){
				var transformZoomArea = d3.select(".zoomArea").attr("transform");
			  	var splitTransformZoomArea = transformZoomArea.split("rotate")[0];
			  	d3.select('.zoomArea').attr("transform",splitTransformZoomArea + "rotate("+nAngle+",750,400)");
			  	// d3.select('.zoomArea').attr("transform",splitTransformZoomArea + "rotate("+nAngle+",400,400)");
			}

			function rotateMenu(nAngle,svgMenu){
				var transformZoomArea = d3.select("#"+svgMenu).attr("transform");
			  	var splitTransformZoomArea = transformZoomArea.split("rotate")[0];
			  	d3.select('#'+svgMenu).attr("transform",splitTransformZoomArea + "rotate("+nAngle+")");
			  	d3.select('#'+svgMenu).select(".arrow").attr("transform","rotate(" + (-nAngle) + ")");
				
			}

			function rotateMeubleSelected(nAngle){
				if (d3.select('.meubleSelected')[0][0] != null){
					var transformZoomArea = d3.select(".meubleSelected").attr("transform");
				  	var splitTransformZoomArea = transformZoomArea.split("rotate")[0];
				  	var rotateCenter = transformZoomArea.split("rotate")[1].split(",");
				  	// console.log(rotateCenter);
				  	d3.select('.meubleSelected').attr("transform",splitTransformZoomArea + "rotate("+nAngle+","+rotateCenter[1]+","+rotateCenter[2]);
				  	var objectList;
				  	switch(d3.select('.meubleSelected').attr("meubleType")){
				  		case "table":
				  			objectList = tvsOnMap;
				  			break;
				  		// case "table":
				  		// 	objectList = tablesOnMap;
				  		// 	break;
				  		default:
				  			objectList = sofasOnMap;
				  	}

				  	objectList[d3.select('.meubleSelected').attr("meubleIndex")].angle = nAngle;
				  			setObjectPoints(objectList,d3.select('.meubleSelected').attr("meubleIndex"));

				  	if(isObjectBadPlaced(objectList,d3.select('.meubleSelected').attr("meubleIndex"))){
				    	d3.select('.meubleSelected').classed("badPlaceObject",true);
				    }else{
				    	d3.select('.meubleSelected').classed("badPlaceObject",false);
				    };
				}
			    // console.log(d3.select('.meubleSelected'));
			    // d3.select('.meubleSelected').parentNode.select(".removeObject").attr("transform","translate(" + (objectList[index].objectPoints[0].x - 10) + "," + (objectList[index].objectPoints[0].y - 10) + ")");
			}

			//--------------------------------------------  rotate function ---------------------------------------------------

			// update the element
			// function update(nAngle) {
			//   	currentAngle = nAngle;
			//   	// adjust the text on the range slider
			//   	d3.select("#nAngle-value").text(nAngle);
			//   	d3.select("#nAngle").property("value", nAngle);

			//   	// rotate
			//   	container.select(".g-sofa").select('rect') 
			//     	.attr("transform", "translate(" + rectX + "," + rectY + ")rotate(" + nAngle + "," + sofaSelectedCenterX + "," + sofaSelectedCenterY + ")");
			//     setSofaPoints();
			//     // console.log(sofaPoints);
			//     if(isSofaBadPlaced()){
			// 		container.select(".g-sofa").select('rect').classed("badPlace",true);
			// 		container.select(".g-sofa").select("text").text("BadPlaced").attr("transform", "translate(" + (rectX + sofaSelectedCenterX - 85) + "," + (rectY + sofaSelectedCenterY + 8) + ")");
			// 		if(sofaPlacedCheck)
			// 			sofaPlacedCheck.style("visibility","hidden");
			// 	}else{
			// 		container.select(".g-sofa").select("text").text("Check to place it").attr("transform", "translate(" + (rectX + sofaSelectedCenterX - 120) + "," + (rectY + sofaSelectedCenterY + 8) + ")");
			// 		container.select(".g-sofa").select('rect').classed("badPlace",false);
			// 		if(sofaPlacedCheck)
			// 			sofaPlacedCheck.style("visibility","visible");
			// 	}
			// 	if(sofaPlacedCheck)
			// 		sofaPlacedCheck.attr("transform","translate(" + (sofaPoints[2].x - 10) + "," + (sofaPoints[2].y - 10) + ")");
			// }

			// function setSofaPoints(){
			// 	sofaPoints[0].x = sofaSelectedCenterX + rectX + sofaDemiDiagonal * Math.cos(currentAngle / 180 * Math.PI - Math.atan(sofaSelectedCenterY / sofaSelectedCenterX) + Math.PI);
			// 	sofaPoints[0].y = sofaSelectedCenterY + rectY + sofaDemiDiagonal * Math.sin(currentAngle / 180 * Math.PI - Math.atan(sofaSelectedCenterY / sofaSelectedCenterX) + Math.PI);
			// 	sofaPoints[1].x = sofaSelectedCenterX + rectX + sofaDemiDiagonal * Math.cos(currentAngle / 180 * Math.PI + Math.atan(sofaSelectedCenterY / sofaSelectedCenterX));
			// 	sofaPoints[1].y = sofaSelectedCenterY + rectY + sofaDemiDiagonal * Math.sin(currentAngle / 180 * Math.PI + Math.atan(sofaSelectedCenterY / sofaSelectedCenterX));
			// 	sofaPoints[2].x = sofaSelectedCenterX + rectX + sofaDemiDiagonal * Math.cos(currentAngle / 180 * Math.PI - Math.atan(sofaSelectedCenterY / sofaSelectedCenterX));
			// 	sofaPoints[2].y = sofaSelectedCenterY + rectY + sofaDemiDiagonal * Math.sin(currentAngle / 180 * Math.PI - Math.atan(sofaSelectedCenterY / sofaSelectedCenterX));
			// 	sofaPoints[3].x = sofaSelectedCenterX + rectX + sofaDemiDiagonal * Math.cos(currentAngle / 180 * Math.PI + Math.atan(sofaSelectedCenterY / sofaSelectedCenterX) + Math.PI);
			// 	sofaPoints[3].y = sofaSelectedCenterY + rectY + sofaDemiDiagonal * Math.sin(currentAngle / 180 * Math.PI + Math.atan(sofaSelectedCenterY / sofaSelectedCenterX) + Math.PI);
			// }

			// function isSofaBadPlaced(){
			// 	for(var i = 0; i < sofaPoints.length; i++){
			// 		if(sofaPoints[i].x < 60 || sofaPoints[i].x > 740 || sofaPoints[i].y < 60 || sofaPoints[i].y > 740)
			// 			return true;
			// 	}
			// 	return false;
			// }

			//------------------------------------------------BEDS------------------------------------------------------
        	var tvsOnMap = [];
        	var tablesOnMap = [];
        	var sofasOnMap = [];
        	//------------------------------------------------BEDS------------------------------------------------------
        	var objectColor;
        	//----------------------------------------------------------------------------------------------------------

        	function objectSelect(meuble, index, type){
	            // console.log(index);
	            switch(type){
	            	case "table":
	            		if(mtv)mtv.hide();
	            		changeMenuLayer(false,"tvMenu");
	            		break;
	            	// case "table":
	            	// 	if(mTable)mTable.hide();
	            	// 	changeMenuLayer(false,"tableMenu");
	            	// 	break;
	            	default:
	            		if(m)m.hide();
	            		changeMenuLayer(false,"piemenu");
	            }
	            objectColor = meuble[index].color;
	            console.log(objectColor);
	            objectCreate(clickX,clickY,meuble[index].size.width,meuble[index].size.length,type, meuble[index].id, meuble[index].textureId);

          	}


          	function objectCreate(px,py,width,height,type, meubleId, textureId){
          		showResetButton();
          		var angle = 0;
          		var demiDiagonal = Math.sqrt(width * width + height * height) / 2;
          		var objectCenterX = width / 2;
	            var objectCenterY = height / 2;
	            var objectPoints = [
	        		{x : 0, y : 0},
	        		{x : 0, y : 0},
	        		{x : 0, y : 0},
	        		{x : 0, y : 0}
	        	];
	            initObjectPointsPosition(objectPoints,px,py,width,height);

          		var dataObject = {
          			angle : angle,
          			demiDiagonal : demiDiagonal,
          			objectCenterX : objectCenterX,
          			objectCenterY : objectCenterY,
          			objectPoints : objectPoints,
          			rectX : createPosition[type].x,
          			rectY : createPosition[type].y,
          			// rectX : rectX,
          			// rectY : rectY,
          			width : width,
          			height : height
          		};
          		


          		switch(type){
          			case "table":
          				tvsOnMap.push(dataObject);
          				addObjectOnMap(domTvs,tvsOnMap,tvsOnMap.length - 1,"table", meubleId, textureId);
          				break;
          			// case "table":
          			// 	tablesOnMap.push(dataObject);
          			// 	addObjectOnMap(domTables,tablesOnMap,tablesOnMap.length - 1,"table", meubleId, textureId);
          			// 	break;
          			case "sofa":
          				sofasOnMap.push(dataObject);
          				addObjectOnMap(domSofas,sofasOnMap,sofasOnMap.length - 1,"sofa", meubleId, textureId);
          				break;
          			default:;
          		}

          	}

          	function initObjectPointsPosition(objectPoints,px,py,width,height){
          		objectPoints[0].x = px;
				objectPoints[0].y = py + height;
				objectPoints[1].x = px + width;
				objectPoints[1].y = py + height;
				objectPoints[2].x = px + width;
				objectPoints[2].y = py;
				objectPoints[3].x = px;
				objectPoints[3].y = py;
          	}

          	function setObjectPoints(objectList, index){
          		var objectMeuble = objectList[index];
          		objectMeuble.objectPoints[0].x = objectMeuble.objectCenterX + objectMeuble.rectX + objectMeuble.demiDiagonal * Math.cos(objectMeuble.angle / 180 * Math.PI - Math.atan(objectMeuble.objectCenterY / objectMeuble.objectCenterX) + Math.PI);
				objectMeuble.objectPoints[0].y = objectMeuble.objectCenterY + objectMeuble.rectY + objectMeuble.demiDiagonal * Math.sin(objectMeuble.angle / 180 * Math.PI - Math.atan(objectMeuble.objectCenterY / objectMeuble.objectCenterX) + Math.PI);
				objectMeuble.objectPoints[1].x = objectMeuble.objectCenterX + objectMeuble.rectX + objectMeuble.demiDiagonal * Math.cos(objectMeuble.angle / 180 * Math.PI + Math.atan(objectMeuble.objectCenterY / objectMeuble.objectCenterX));
				objectMeuble.objectPoints[1].y = objectMeuble.objectCenterY + objectMeuble.rectY + objectMeuble.demiDiagonal * Math.sin(objectMeuble.angle / 180 * Math.PI + Math.atan(objectMeuble.objectCenterY / objectMeuble.objectCenterX));
				objectMeuble.objectPoints[2].x = objectMeuble.objectCenterX + objectMeuble.rectX + objectMeuble.demiDiagonal * Math.cos(objectMeuble.angle / 180 * Math.PI - Math.atan(objectMeuble.objectCenterY / objectMeuble.objectCenterX));
				objectMeuble.objectPoints[2].y = objectMeuble.objectCenterY + objectMeuble.rectY + objectMeuble.demiDiagonal * Math.sin(objectMeuble.angle / 180 * Math.PI - Math.atan(objectMeuble.objectCenterY / objectMeuble.objectCenterX));
				objectMeuble.objectPoints[3].x = objectMeuble.objectCenterX + objectMeuble.rectX + objectMeuble.demiDiagonal * Math.cos(objectMeuble.angle / 180 * Math.PI + Math.atan(objectMeuble.objectCenterY / objectMeuble.objectCenterX) + Math.PI);
				objectMeuble.objectPoints[3].y = objectMeuble.objectCenterY + objectMeuble.rectY + objectMeuble.demiDiagonal * Math.sin(objectMeuble.angle / 180 * Math.PI + Math.atan(objectMeuble.objectCenterY / objectMeuble.objectCenterX) + Math.PI);
          	}

          	function addObjectOnMap(meubleParent,objectList,index,type, meubleId, textureId){
          		// var color;
          		// switch(type){
          		// 	case "bed":
          		// 		color = "#8A2BE2";
          		// 		break;
          		// 	case "table":
          		// 		color = "#A52A2A";
          		// 		break;
          		// 	case "sofa":
          		// 		color = "#FFD700";
          		// 		break;
          		// 	default:;
          		// }    

          		setObjectPoints(objectList, index);
          		sendDataToVRServer(objectList,index,type,meubleId,textureId,"tableAddFurniture");


          		switch(objectColor){
	            	case "beige":objectColor = "#f5f5dc";break;
	            	case "noir":objectColor = "black";break;
	            	case "bordeau":objectColor = "red";break;
	            	case "blanc":objectColor = "white";break;
	            	case "gris":objectColor = "#A9A9A9";break;
	            	case "cuir":objectColor = "gray";break;
	            	case "taupe":objectColor = "#483C32";break;
	            	case "tissus":objectColor = "#DEB887";break;
	            	default:;
	            }



          		var dragObject = d3.behavior.drag()
			    	.on("dragstart", mouseOn)
			    	.on("drag", mouseMove)
			    	.on("dragend", mouseOff);

			    var element = meubleParent.append("g").attr("class","g-element").attr("transform","translate(0,0)");
				d3.select('.meubleSelected').classed("meubleSelected",false);

          		element.append("rect").attr("meubleId",meubleId).attr("textureId",textureId).attr("meubleIndex",index).attr("meubleType",type).classed("meubleSelected",true).attr("transform","translate(" + objectList[index].rectX + "," + objectList[index].rectY + ")rotate(" + objectList[index].angle + "," + objectList[index].objectCenterX + "," + objectList[index].objectCenterY + ")").attr("width",objectList[index].width).attr("height",objectList[index].height).attr("opacity",0.5).style("fill",objectColor).call(dragObject);

          		updateR(0);

          		element.append("text").attr("transform","translate(" + objectList[index].objectPoints[3].x + "," + objectList[index].objectPoints[3].y + ")").text(type + "-" + index);
           	}

           	function isObjectBadPlaced(objectList,index){
           		var objectMeuble = objectList[index];
           		var areaX = [];

				for(var i = 0; i < objectMeuble.objectPoints.length; i++){
					if(objectMeuble.objectPoints[i].x < 60 || objectMeuble.objectPoints[i].x > 1440 || objectMeuble.objectPoints[i].y < 60 || objectMeuble.objectPoints[i].y > 740)
						return true;
					if(objectMeuble.objectPoints[i].x > 740 && objectMeuble.objectPoints[i].y < 340)
						return true;

					areaX.push(objectMeuble.objectPoints[i].x);
				}
				if(areaX[0] > 750 && areaX[1] > 750 && areaX[2] > 750 && areaX[3] > 750){
					return false;
				}else if(areaX[0] < 740 && areaX[1] < 740 && areaX[2] < 740 && areaX[3] < 740){
					return false;
				}
				
				return true;
			}

			// function isObjectBadPlaced(objectList,index){
   //         		var objectMeuble = objectList[index];
			// 	for(var i = 0; i < objectMeuble.objectPoints.length; i++){
			// 		if(objectMeuble.objectPoints[i].x < 60 || objectMeuble.objectPoints[i].x > 740 || objectMeuble.objectPoints[i].y < 60 || objectMeuble.objectPoints[i].y > 740)
			// 			return true;
			// 	}
			// 	return false;
			// }

			//drag function could be used in tuio
			// function tuioMouseOn(){

			// }

			// function tuioMouseMove(){

			// }

			// function tuioMouseOff(){

			// }

			// function tuioRotate(){
				
			// }



			var oList;
			var oIndex;
			var oType;



			function mouseOn(d){
				d3.select('.meubleSelected').classed("meubleSelected",false);
			    d3.select(this).classed("meubleSelected",true);
			    oType = d3.select('.meubleSelected').attr("meubleType");
			    oIndex = d3.select('.meubleSelected').attr("meubleIndex");
				var color;
          		switch(oType){
          			case "table":
          				color = "#8A2BE2";
          				break;
          			// case "table":
          			// 	color = "#A52A2A";
          			// 	break;
          			case "sofa":
          				color = "#FFD700";
          				break;
          			default:;
          		}
          		d3.event.sourceEvent.stopPropagation();
				d3.select(this).attr("opacity",0.9).style("stroke",color);
				
			    // var r = d3.select('.meubleSelected').attr("transform").split("rotate(")[1].split(",")[0];
			    // updateR(r);
			    
			    switch(d3.select('.meubleSelected').attr("meubleType")){
			  		case "table":
			  			oList = tvsOnMap;
			  			break;
			  		// case "table":
			  		// 	oList = tablesOnMap;
			  		// 	break;
			  		default:
			  			oList = sofasOnMap;

			  	}
          	}

          	function mouseMove(d){
          		if(selectValue == "touchMove"){
	          		oList[oIndex].rectX += d3.event.dx;
					oList[oIndex].rectY += d3.event.dy;

			    	setObjectPoints(oList,oIndex);
			    	if(isObjectBadPlaced(oList,oIndex)){
			    		d3.select(this).classed("badPlaceObject",true);
			    	}else{
			    		d3.select(this).classed("badPlaceObject",false);
			    	};
					d3.select(this).attr("transform","translate(" + oList[oIndex].rectX + "," + oList[oIndex].rectY + ")rotate(" + oList[oIndex].angle + "," + oList[oIndex].objectCenterX + "," + oList[oIndex].objectCenterY + ")");
					d3.select(this.parentNode).select("text").attr("transform","translate(" + oList[oIndex].rectX + "," + oList[oIndex].rectY + ")");
				}else if(selectValue == "touchRotate"){
					var centerRotateX = oList[oIndex].rectX + oList[oIndex].objectCenterX;
					var centerRotateY = oList[oIndex].rectY + oList[oIndex].objectCenterY;
					// console.log(centerRotateX - d3.event.sourceEvent.clientX);
					// console.log(centerRotateY - d3.event.sourceEvent.clientY);
					rotateMeubleSelected((Math.atan2(centerRotateY - d3.event.sourceEvent.clientY,centerRotateX - d3.event.sourceEvent.clientX) + Math.PI) * 360/2/Math.PI);

				}
       		}

          	function mouseOff(d){
          		d3.select(this).attr("opacity",0.5).style("stroke","#FFFFFF");
			   	if(isObjectBadPlaced(oList,oIndex)){
			   		d3.select(this.parentNode).remove();
			   		socket.emit("removeFurniture", {type : d3.select(this).attr("meubleType"), index : d3.select(this).attr("meubleIndex")});
			   	}else{
					d3.select(this).classed("badPlaceObject",false);
					sendDataToVRServer(oList,oIndex, d3.select(this).attr("meubleType"),d3.select(this).attr("meubleId"),d3.select(this).attr("textureId"),"moveFurniture");
			   	};
          	}

          	function sendDataToVRServer(objectList, index, type, meubleId, textureId, actionType){
          		var object = {
				   	type : type,
				   	id: meubleId,
				   	textureId: textureId,
				   	index:index,
				   	position:{
				   		x:objectList[index].objectPoints[3].x / 50,
				   		y:0.5,
				   		z:objectList[index].objectPoints[3].y / 50,
				   		angle: (360 - objectList[index].angle)
				   	}
				};
				socket.emit(actionType, object);
				console.log(object);

				console.log("sofa [" + actionType + "} Send to server");
          	}

          	var mtv, mTable;

          	function createMenuMeuble(x,y,menuElements,type, id){
          		var idMenu = "piemenu";
          		var svgMenu = "menu-holder";

          		var menuCorrespondantId = menuElements[id];

          		// for(var i = 0; i < menuElements.length;i++){
          		// 	if(menuElements[i].id == id){
          		// 		menuCorrespondantId.push(menuElements[i]);
          		// 	}
          		// }

          		console.log(menuCorrespondantId);
          		
	            
          		switch(type){
	            	case "table":
	            		idMenu = "tableMenu";
	            		svgMenu = "menu-table";
	            		changeMenuLayer(true,idMenu);
	            		d3.select("#" + svgMenu).selectAll("g").each(function(){
			              	d3.select(this).remove();
			            });
	            		if(mTable){
	              			mTable.hide();
	            		}
	            		mTable = new d3.radialMenu().radius(50).thickness(150).iconSize(120).arrow("img/arrow.png")
	                        .appendTo("#" + svgMenu).show(menuCorrespondantId);
	            		break;
	            	case "table":
	            		idMenu = "tvMenu";
	            		svgMenu = "menu-tv";
	            		changeMenuLayer(true,idMenu);
	            		d3.select("#" + svgMenu).selectAll("g").each(function(){
			              	d3.select(this).remove();
			            });
	            		if(mtv){
	              			mtv.hide();
	            		}
	            		mtv = new d3.radialMenu().radius(50).thickness(150).iconSize(120).arrow("img/arrow.png")
	                        .appendTo("#" + svgMenu).show(menuCorrespondantId);
	            		break;
	            	default: 
	            		idMenu = "piemenu";
	            		svgMenu = "menu-holder";
	            		changeMenuLayer(true,idMenu);
	            		d3.select("#" + svgMenu).selectAll("g").each(function(){
			              	d3.select(this).remove();
			            });
	            		if(m){
	              			m.hide();
	            		}
	            		m = new d3.radialMenu().radius(50).thickness(150).iconSize(120).arrow("img/arrow.png")
	                        .appendTo("#" + svgMenu).show(menuCorrespondantId);
	            };

	            if(idMenu == "tableMenu"){
		            var menu = $("#" + idMenu);
		            menu.css('position', 'absolute');
		            menu.css("left", x - 200);
		            menu.css("top", y - 200);
		        }
          	}

          

          	function changeMenuLayer(flag,idMenu){
	            if(flag){
	              	d3.select("#" + idMenu).attr("class","piemenufirstLayer");
	            }else{
	              	d3.select("#" + idMenu).attr("class","piemenuLastLayer");
	            }
          	}




        </script>

  </body>
</html>

